export class AnimationController{constructor(){this.observers=new Map,this.animatedElements=new Set,this.respectsReducedMotion=this.checkReducedMotionPreference(),this.config={rootMargin:"0px 0px -10% 0px",threshold:.1,animationDelay:100,maxStaggerDelay:600},this.handleIntersection=this.handleIntersection.bind(this),this.handleReducedMotionChange=this.handleReducedMotionChange.bind(this)}init(){try{this.setupReducedMotionListener(),this.createIntersectionObserver(),console.log("Animation controller initialized")}catch(e){console.error("Error initializing animation controller:",e)}}checkReducedMotionPreference(){return!!window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches}setupReducedMotionListener(){if(!window.matchMedia)return;const e=window.matchMedia("(prefers-reduced-motion: reduce)");e.addEventListener?e.addEventListener("change",this.handleReducedMotionChange):e.addListener(this.handleReducedMotionChange)}handleReducedMotionChange(e){this.respectsReducedMotion=e.matches,console.log("Reduced motion preference: "+(this.respectsReducedMotion?"enabled":"disabled")),this.respectsReducedMotion&&this.showAllElements()}createIntersectionObserver(){if(!("IntersectionObserver"in window))return console.warn("IntersectionObserver not supported, animations disabled"),void this.showAllElements();const e=new IntersectionObserver(this.handleIntersection,{root:null,rootMargin:this.config.rootMargin,threshold:this.config.threshold});this.observers.set("scroll",e)}handleIntersection(e){if(this.respectsReducedMotion)return void e.forEach(e=>{e.isIntersecting&&this.showElement(e.target,!0)});const t=new Map;e.forEach(e=>{if(e.isIntersecting&&!this.animatedElements.has(e.target)){const n=this.findAnimationContainer(e.target),i=n?n.id||n.className:"default";t.has(i)||t.set(i,[]),t.get(i).push(e.target)}}),t.forEach(e=>{this.animateElementsWithStagger(e)})}findAnimationContainer(e){const t=[".projects",".contact__links",".nav__list"];for(const n of t){const t=e.closest(n);if(t)return t}return null}animateElementsWithStagger(e){e.forEach((e,t)=>{const n=Math.min(t*this.config.animationDelay,this.config.maxStaggerDelay);setTimeout(()=>{this.showElement(e)},n)})}showElement(e,t=!1){if(this.animatedElements.has(e))return;this.animatedElements.add(e),t||this.respectsReducedMotion?(e.style.opacity="1",e.style.transform="none",e.classList.add("animate")):e.classList.add("animate");const n=this.observers.get("scroll");n&&n.unobserve(e)}showAllElements(){document.querySelectorAll(".fade-in, .slide-in-left, .slide-in-right").forEach(e=>{this.showElement(e,!0)})}observeElements(e){const t=this.observers.get("scroll");if(!t)return;const n=document.querySelectorAll(e);n.forEach(e=>{if(!e.classList.contains("fade-in")&&!e.classList.contains("slide-in-left")&&!e.classList.contains("slide-in-right")){const t=this.getAnimationType(e);e.classList.add(t)}t.observe(e)}),console.log(`Observing ${n.length} elements for animations`)}getAnimationType(e){const t=e.dataset.animation;return t||(e.classList.contains("project-card")?"fade-in":e.classList.contains("contact__link")?"slide-in-left":e.classList.contains("nav__link")?"slide-in-right":"fade-in")}triggerInitialAnimations(){if(this.respectsReducedMotion)return void this.showAllElements();if(!this.observers.get("scroll"))return;document.querySelectorAll(".fade-in, .slide-in-left, .slide-in-right").forEach(e=>{this.isElementInViewport(e)&&this.showElement(e)})}isElementInViewport(e){const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight;return t.top>=0&&t.top<=.9*n}enableSmoothScroll(){"scrollBehavior"in document.documentElement.style||(console.log("Adding smooth scroll polyfill"),this.addSmoothScrollPolyfill())}addSmoothScrollPolyfill(){document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("href").substring(1),i=document.getElementById(n);i&&(t.preventDefault(),this.smoothScrollTo(i))})})}smoothScrollTo(e){const t=e.offsetTop,n=window.pageYOffset,i=t-n;let s=null;const o=e=>{null===s&&(s=e);const t=e-s,r=this.easeInOutQuad(t,n,i,800);window.scrollTo(0,r),t<800&&requestAnimationFrame(o)};requestAnimationFrame(o)}easeInOutQuad(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}createCustomAnimation(e,t,n={}){if(this.respectsReducedMotion){const n=t[t.length-1];return Object.assign(e.style,n),Promise.resolve()}return"animate"in e?e.animate(t,{duration:300,easing:"ease-out",fill:"forwards",...n}).finished:this.fallbackAnimation(e,t,n)}fallbackAnimation(e,t,n){return new Promise(i=>{const s=n.duration||300,o=t[t.length-1];e.style.transition=`all ${s}ms ease-out`,Object.assign(e.style,o),setTimeout(()=>{e.style.transition="",i()},s)})}pauseAnimations(){document.documentElement.style.setProperty("--animation-play-state","paused")}resumeAnimations(){document.documentElement.style.removeProperty("--animation-play-state")}destroy(){if(this.observers.forEach(e=>{e.disconnect()}),this.observers.clear(),window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion: reduce)");e.removeEventListener?e.removeEventListener("change",this.handleReducedMotionChange):e.removeListener(this.handleReducedMotionChange)}this.animatedElements.clear(),console.log("Animation controller destroyed")}}