export class NavigationManager{constructor(){this.activeSection=null,this.sections=[],this.navLinks=[],this.isScrolling=!1,this.scrollTimeout=null,this.config={scrollOffset:80,scrollDuration:800,throttleDelay:100},this.handleNavClick=this.handleNavClick.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.updateActiveSection=this.updateActiveSection.bind(this)}init(){try{this.cacheDOMElements(),this.setupEventListeners(),this.updateActiveSection(),console.log("Navigation manager initialized")}catch(t){console.error("Error initializing navigation manager:",t)}}cacheDOMElements(){this.navLinks=Array.from(document.querySelectorAll('.nav__link[href^="#"]')),this.sections=this.navLinks.map(t=>{const e=t.getAttribute("href").substring(1),i=document.getElementById(e);return i?{id:e,element:i,link:t}:null}).filter(Boolean),console.log(`Found ${this.sections.length} navigable sections`)}setupEventListeners(){this.navLinks.forEach(t=>{t.addEventListener("click",this.handleNavClick)}),window.addEventListener("scroll",this.throttle(this.handleScroll,this.config.throttleDelay)),document.addEventListener("keydown",this.handleKeydown),window.addEventListener("hashchange",this.handleHashChange.bind(this))}handleNavClick(t){t.preventDefault();const e=t.currentTarget.getAttribute("href").substring(1),i=document.getElementById(e);i&&(this.scrollToSection(i,e),this.updateURL(e),this.announceNavigation(e))}scrollToSection(t,e){const i=this.getHeaderHeight(),n=t.offsetTop-i-this.config.scrollOffset;this.isScrolling=!0,this.scrollTimeout&&clearTimeout(this.scrollTimeout),window.scrollTo({top:Math.max(0,n),behavior:"smooth"}),this.scrollTimeout=setTimeout(()=>{this.isScrolling=!1,this.updateActiveSection()},this.config.scrollDuration),this.setActiveSection(e)}handleScroll(){this.isScrolling||this.updateActiveSection()}updateActiveSection(){const t=window.pageYOffset,e=this.getHeaderHeight();let i=null;for(const n of this.sections){const o=n.element.getBoundingClientRect(),s=o.top+t,c=s+o.height;if(s<=t+e+this.config.scrollOffset&&c>t+e){i=n.id;break}}!i&&this.sections.length>0&&(i=this.sections[0].id),i&&i!==this.activeSection&&this.setActiveSection(i)}setActiveSection(t){this.activeSection=t,this.navLinks.forEach(e=>{const i=e.getAttribute("href").substring(1)===t;e.classList.toggle("nav__link--active",i),e.setAttribute("aria-current",i?"page":"false")}),this.dispatchSectionChangeEvent(t)}handleKeydown(t){if(!(t.altKey||t.ctrlKey||t.metaKey))switch(t.key){case"Home":"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.preventDefault(),this.scrollToTop());break;case"End":"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.preventDefault(),this.scrollToBottom())}}handleHashChange(){const t=window.location.hash.substring(1);if(t&&!this.isScrolling){const e=document.getElementById(t);e&&this.scrollToSection(e,t)}}scrollToTop(){this.isScrolling=!0,window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{this.isScrolling=!1,this.updateActiveSection()},this.config.scrollDuration)}scrollToBottom(){this.isScrolling=!0,window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"}),setTimeout(()=>{this.isScrolling=!1,this.updateActiveSection()},this.config.scrollDuration)}getHeaderHeight(){const t=document.querySelector(".header");return t?t.offsetHeight:0}updateURL(t){if(history.replaceState){const e=`${window.location.pathname}${window.location.search}#${t}`;history.replaceState(null,null,e)}}announceNavigation(t){const e=document.getElementById(t);if(e){const i=e.querySelector("h1, h2, h3, h4, h5, h6"),n=i?i.textContent:t,o=document.createElement("div");o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),o.className="sr-only",o.textContent=`Navegou para a secção: ${n}`,document.body.appendChild(o),setTimeout(()=>{document.body.removeChild(o)},1e3)}}dispatchSectionChangeEvent(t){const e=new CustomEvent("sectionchange",{detail:{activeSection:t,previousSection:this.activeSection}});document.dispatchEvent(e)}throttle(t,e){let i,n=0;return function(...o){const s=Date.now();s-n>e?(t.apply(this,o),n=s):(clearTimeout(i),i=setTimeout(()=>{t.apply(this,o),n=Date.now()},e-(s-n)))}}getActiveSection(){return this.activeSection}navigateToSection(t){const e=document.getElementById(t);e&&(this.scrollToSection(e,t),this.updateURL(t))}destroy(){this.navLinks.forEach(t=>{t.removeEventListener("click",this.handleNavClick)}),window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("hashchange",this.handleHashChange),document.removeEventListener("keydown",this.handleKeydown),this.scrollTimeout&&clearTimeout(this.scrollTimeout),console.log("Navigation manager destroyed")}}