export class GitHubApiClient{constructor(e){this.username=e,this.baseURL="https://api.github.com",this.cachePrefix="github-api",this.cacheTimeout=3e5,this.rateLimitRemaining=null,this.rateLimitReset=null,this.requestConfig={headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Portfolio-Site/1.0"}}}async getRepositories(e=10){const t=`${this.cachePrefix}-repos-${this.username}`;try{const a=this.getCachedData(t);if(a)return console.log("Using cached repository data"),a.slice(0,e);console.log("Fetching repositories from GitHub API");const r=await this.fetchRepositories();return this.setCachedData(t,r),r.slice(0,e)}catch(a){console.error("Error fetching repositories:",a);const r=this.getStaleCache(t);if(r)return console.log("Using stale cache data as fallback"),r.slice(0,e);throw a}}async fetchRepositories(){const e=`${this.baseURL}/users/${this.username}/repos`,t=new URLSearchParams({sort:"updated",direction:"desc",per_page:"20",type:"owner"}),a=await this.makeRequest(`${e}?${t}`),r=await a.json();return this.processRepositories(r)}processRepositories(e){const t=["IOT","empregabilidade-amar-terra-verde","IOTCNT","TimeAdministrator","portfolio-dev-senior","curso-js-2026-pt"];let a=e.filter(e=>!e.fork&&!e.archived&&t.includes(e.name)).map(e=>({id:e.id,name:e.name,description:e.description||this.getDefaultDescription(e.name),html_url:e.html_url,language:e.language,topics:e.topics||[],stargazers_count:e.stargazers_count,forks_count:e.forks_count,updated_at:e.updated_at,created_at:e.created_at,size:e.size,visibility:e.private?"Private":"Public"}));if(a.length<6){const e=a.map(e=>e.name);t.filter(t=>!e.includes(t)).forEach(e=>{a.push({id:`placeholder-${e}`,name:e,description:this.getDefaultDescription(e),html_url:`https://github.com/smpsandro1239/${e}`,language:this.getDefaultLanguage(e),topics:[],stargazers_count:0,forks_count:0,updated_at:(new Date).toISOString(),created_at:(new Date).toISOString(),size:0,visibility:"Public",isPlaceholder:!0})})}return a.sort((e,a)=>t.indexOf(e.name)-t.indexOf(a.name)).slice(0,6)}getDefaultDescription(e){return{IOT:"Projetos e soluções IoT com ESP32, sensores e conectividade LoRa","empregabilidade-amar-terra-verde":"Sistema web para gestão de empregabilidade e sustentabilidade ambiental",IOTCNT:"Contador inteligente IoT com interface web e monitorização remota",TimeAdministrator:"Aplicação TypeScript para gestão e administração de tempo","portfolio-dev-senior":"Portfolio profissional desenvolvido com HTML5, CSS3 e JavaScript vanilla","curso-js-2026-pt":"Curso completo de JavaScript moderno em português europeu"}[e]||"Projeto de desenvolvimento de software"}getDefaultLanguage(e){return{IOT:"C++","empregabilidade-amar-terra-verde":"JavaScript",IOTCNT:"C++",TimeAdministrator:"TypeScript","portfolio-dev-senior":"HTML","curso-js-2026-pt":"JavaScript"}[e]||"JavaScript"}async getUserStats(){const e=`${this.cachePrefix}-user-${this.username}`;try{const t=this.getCachedData(e);if(t)return t;const a=`${this.baseURL}/users/${this.username}`,r=await this.makeRequest(a),i=await r.json(),s={public_repos:i.public_repos,followers:i.followers,following:i.following,created_at:i.created_at,updated_at:i.updated_at,bio:i.bio,location:i.location,blog:i.blog};return this.setCachedData(e,s),s}catch(e){return console.error("Error fetching user stats:",e),{public_repos:0,followers:0,following:0,created_at:null,updated_at:null}}}async makeRequest(e){if(this.isRateLimited())throw new Error("Rate limit exceeded. Please try again later.");const t=new AbortController,a=setTimeout(()=>t.abort(),1e4);try{const r=await fetch(e,{...this.requestConfig,signal:t.signal});if(clearTimeout(a),this.updateRateLimitInfo(r),!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return r}catch(e){if(clearTimeout(a),"AbortError"===e.name)throw new Error("Request timeout");throw e}}updateRateLimitInfo(e){const t=e.headers.get("X-RateLimit-Remaining"),a=e.headers.get("X-RateLimit-Reset");null!==t&&(this.rateLimitRemaining=parseInt(t,10)),null!==a&&(this.rateLimitReset=1e3*parseInt(a,10)),console.log(`Rate limit: ${this.rateLimitRemaining} requests remaining`)}isRateLimited(){if(null===this.rateLimitRemaining||null===this.rateLimitReset)return!1;return Date.now()>this.rateLimitReset?(this.rateLimitRemaining=null,this.rateLimitReset=null,!1):this.rateLimitRemaining<=0}getCachedData(e){try{const t=sessionStorage.getItem(e);if(!t)return null;const a=JSON.parse(t);return Date.now()-a.timestamp<this.cacheTimeout?a.value:(sessionStorage.removeItem(e),null)}catch(e){return console.warn("Error reading from cache:",e),null}}getStaleCache(e){try{const t=sessionStorage.getItem(e);if(!t)return null;return JSON.parse(t).value}catch(e){return console.warn("Error reading stale cache:",e),null}}setCachedData(e,t){const a={value:t,timestamp:Date.now()};try{sessionStorage.setItem(e,JSON.stringify(a))}catch(t){if(console.warn("Error writing to cache:",t),"QuotaExceededError"===t.name){this.clearOldCache();try{sessionStorage.setItem(e,JSON.stringify(a))}catch(e){console.warn("Failed to cache data after cleanup:",e)}}}}clearOldCache(){try{const e=Object.keys(sessionStorage),t=e.filter(e=>e.startsWith(this.cachePrefix)).map(e=>{try{return{key:e,timestamp:JSON.parse(sessionStorage.getItem(e)).timestamp||0}}catch{return{key:e,timestamp:0}}}).sort((e,t)=>e.timestamp-t.timestamp),a=t.slice(0,Math.ceil(t.length/2));a.forEach(e=>{sessionStorage.removeItem(e.key)}),console.log(`Cleared ${a.length} old cache entries`)}catch(e){console.warn("Error clearing old cache:",e)}}isCacheStale(){const e=`${this.cachePrefix}-repos-${this.username}`;return!this.getCachedData(e)}clearCache(){try{const e=Object.keys(sessionStorage);e.filter(e=>e.startsWith(this.cachePrefix)&&e.includes(this.username)).forEach(e=>{sessionStorage.removeItem(e)}),console.log(`Cleared cache for user: ${this.username}`)}catch(e){console.warn("Error clearing cache:",e)}}getCacheStats(){try{const e=Object.keys(sessionStorage).filter(e=>e.startsWith(this.cachePrefix));let t=0,a=0,r=0;return e.forEach(e=>{const i=sessionStorage.getItem(e);t+=i.length;try{const e=JSON.parse(i);Date.now()-e.timestamp<this.cacheTimeout?a++:r++}catch{r++}}),{totalEntries:e.length,validEntries:a,expiredEntries:r,totalSize:t,averageSize:e.length>0?Math.round(t/e.length):0}}catch(e){return console.warn("Error getting cache stats:",e),null}}}