export class GitHubApiClient{constructor(e){this.username=e,this.baseURL="https://api.github.com",this.cachePrefix="github-api",this.cacheTimeout=3e5,this.rateLimitRemaining=null,this.rateLimitReset=null,this.requestConfig={headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Portfolio-Site/1.0"}}}async getRepositories(e=10){const t=`${this.cachePrefix}-repos-${this.username}`;try{const r=this.getCachedData(t);if(r)return console.log("Using cached repository data"),r.slice(0,e);console.log("Fetching repositories from GitHub API");const a=await this.fetchRepositories();return this.setCachedData(t,a),a.slice(0,e)}catch(r){console.error("Error fetching repositories:",r);const a=this.getStaleCache(t);if(a)return console.log("Using stale cache data as fallback"),a.slice(0,e);throw r}}async fetchRepositories(){const e=`${this.baseURL}/users/${this.username}/repos`,t=new URLSearchParams({sort:"updated",direction:"desc",per_page:"20",type:"owner"}),r=await this.makeRequest(`${e}?${t}`),a=await r.json();return this.processRepositories(a)}processRepositories(e){const t=["IOT","empregabilidade-amar-terra-verde","IOTCNT","TimeAdministrator","portfolio-dev-senior","curso-js-2026-pt"];return e.filter(e=>!e.fork&&!e.archived&&t.includes(e.name)).map(e=>({id:e.id,name:e.name,description:e.description||this.getDefaultDescription(e.name),html_url:e.html_url,language:e.language,topics:e.topics||[],stargazers_count:e.stargazers_count,forks_count:e.forks_count,updated_at:e.updated_at,created_at:e.created_at,size:e.size,visibility:e.private?"Private":"Public"})).sort((e,r)=>t.indexOf(e.name)-t.indexOf(r.name))}getDefaultDescription(e){return{IOT:"Projetos e soluções IoT com ESP32, sensores e conectividade LoRa","empregabilidade-amar-terra-verde":"Sistema web para gestão de empregabilidade e sustentabilidade ambiental",IOTCNT:"Contador inteligente IoT com interface web e monitorização remota",TimeAdministrator:"Aplicação TypeScript para gestão e administração de tempo","portfolio-dev-senior":"Portfolio profissional desenvolvido com HTML5, CSS3 e JavaScript vanilla","curso-js-2026-pt":"Curso completo de JavaScript moderno em português europeu"}[e]||"Projeto de desenvolvimento de software"}async getUserStats(){const e=`${this.cachePrefix}-user-${this.username}`;try{const t=this.getCachedData(e);if(t)return t;const r=`${this.baseURL}/users/${this.username}`,a=await this.makeRequest(r),s=await a.json(),i={public_repos:s.public_repos,followers:s.followers,following:s.following,created_at:s.created_at,updated_at:s.updated_at,bio:s.bio,location:s.location,blog:s.blog};return this.setCachedData(e,i),i}catch(e){return console.error("Error fetching user stats:",e),{public_repos:0,followers:0,following:0,created_at:null,updated_at:null}}}async makeRequest(e){if(this.isRateLimited())throw new Error("Rate limit exceeded. Please try again later.");const t=new AbortController,r=setTimeout(()=>t.abort(),1e4);try{const a=await fetch(e,{...this.requestConfig,signal:t.signal});if(clearTimeout(r),this.updateRateLimitInfo(a),!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return a}catch(e){if(clearTimeout(r),"AbortError"===e.name)throw new Error("Request timeout");throw e}}updateRateLimitInfo(e){const t=e.headers.get("X-RateLimit-Remaining"),r=e.headers.get("X-RateLimit-Reset");null!==t&&(this.rateLimitRemaining=parseInt(t,10)),null!==r&&(this.rateLimitReset=1e3*parseInt(r,10)),console.log(`Rate limit: ${this.rateLimitRemaining} requests remaining`)}isRateLimited(){if(null===this.rateLimitRemaining||null===this.rateLimitReset)return!1;return Date.now()>this.rateLimitReset?(this.rateLimitRemaining=null,this.rateLimitReset=null,!1):this.rateLimitRemaining<=0}getCachedData(e){try{const t=sessionStorage.getItem(e);if(!t)return null;const r=JSON.parse(t);return Date.now()-r.timestamp<this.cacheTimeout?r.value:(sessionStorage.removeItem(e),null)}catch(e){return console.warn("Error reading from cache:",e),null}}getStaleCache(e){try{const t=sessionStorage.getItem(e);if(!t)return null;return JSON.parse(t).value}catch(e){return console.warn("Error reading stale cache:",e),null}}setCachedData(e,t){const r={value:t,timestamp:Date.now()};try{sessionStorage.setItem(e,JSON.stringify(r))}catch(t){if(console.warn("Error writing to cache:",t),"QuotaExceededError"===t.name){this.clearOldCache();try{sessionStorage.setItem(e,JSON.stringify(r))}catch(e){console.warn("Failed to cache data after cleanup:",e)}}}}clearOldCache(){try{const e=Object.keys(sessionStorage),t=e.filter(e=>e.startsWith(this.cachePrefix)).map(e=>{try{return{key:e,timestamp:JSON.parse(sessionStorage.getItem(e)).timestamp||0}}catch{return{key:e,timestamp:0}}}).sort((e,t)=>e.timestamp-t.timestamp),r=t.slice(0,Math.ceil(t.length/2));r.forEach(e=>{sessionStorage.removeItem(e.key)}),console.log(`Cleared ${r.length} old cache entries`)}catch(e){console.warn("Error clearing old cache:",e)}}isCacheStale(){const e=`${this.cachePrefix}-repos-${this.username}`;return!this.getCachedData(e)}clearCache(){try{const e=Object.keys(sessionStorage);e.filter(e=>e.startsWith(this.cachePrefix)&&e.includes(this.username)).forEach(e=>{sessionStorage.removeItem(e)}),console.log(`Cleared cache for user: ${this.username}`)}catch(e){console.warn("Error clearing cache:",e)}}getCacheStats(){try{const e=Object.keys(sessionStorage).filter(e=>e.startsWith(this.cachePrefix));let t=0,r=0,a=0;return e.forEach(e=>{const s=sessionStorage.getItem(e);t+=s.length;try{const e=JSON.parse(s);Date.now()-e.timestamp<this.cacheTimeout?r++:a++}catch{a++}}),{totalEntries:e.length,validEntries:r,expiredEntries:a,totalSize:t,averageSize:e.length>0?Math.round(t/e.length):0}}catch(e){return console.warn("Error getting cache stats:",e),null}}}