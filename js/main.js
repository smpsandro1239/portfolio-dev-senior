import{ThemeManager}from"./theme-manager.js";import{NavigationManager}from"./navigation.js";import{GitHubApiClient}from"./github-api.js";import{AnimationController}from"./animation-controller.js";class PortfolioApp{constructor(){this.themeManager=null,this.navigationManager=null,this.githubClient=null,this.animationController=null,this.config={githubUsername:"smpsandro1239",maxProjects:4,cacheTimeout:3e5},this.handleDOMContentLoaded=this.handleDOMContentLoaded.bind(this),this.handleWindowLoad=this.handleWindowLoad.bind(this),this.handleVisibilityChange=this.handleVisibilityChange.bind(this)}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.handleDOMContentLoaded):this.handleDOMContentLoaded(),window.addEventListener("load",this.handleWindowLoad),document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("unhandledrejection",this.handleUnhandledRejection.bind(this)),this.updateCopyrightYear()}handleDOMContentLoaded(){try{this.initializeModules(),this.loadProjects(),this.setupAnimations(),this.setupHeaderScrollEffect(),console.log("Portfolio app initialized successfully")}catch(e){console.error("Error initializing portfolio app:",e),this.handleError(e)}}handleWindowLoad(){this.animationController&&this.animationController.triggerInitialAnimations(),this.logPerformanceMetrics()}handleVisibilityChange(){document.hidden?console.log("Page hidden - pausing operations"):(console.log("Page visible - resuming operations"),this.githubClient&&this.githubClient.isCacheStale()&&this.loadProjects())}initializeModules(){this.themeManager=new ThemeManager,this.themeManager.init(),this.navigationManager=new NavigationManager,this.navigationManager.init(),this.githubClient=new GitHubApiClient(this.config.githubUsername),this.animationController=new AnimationController,this.animationController.init()}async loadProjects(){const e=document.getElementById("projects-container");if(e)try{e.innerHTML='\n                <div class="projects__loading" aria-live="polite">\n                    A carregar projetos...\n                </div>\n            ';const t=await this.githubClient.getRepositories(this.config.maxProjects);this.renderProjects(t,e)}catch(t){console.error("Error loading projects:",t),this.renderProjectsError(e)}}renderProjects(e,t){if(!e||0===e.length)return void this.renderProjectsFallback(t);const n=e.map(e=>this.createProjectCard(e)).join("");t.innerHTML=n,this.animationController&&this.animationController.observeElements(".project-card")}createProjectCard(e){const t=e.topics&&e.topics.length>0?e.topics.slice(0,5).map(e=>`<span class="topic-tag">${this.escapeHtml(e)}</span>`).join(""):"",n=e.language?`<span class="project-card__language">${this.escapeHtml(e.language)}</span>`:"",o=e.stargazers_count>0?`<div class="project-card__stars">\n                 <span aria-hidden="true">⭐</span>\n                 <span>${e.stargazers_count}</span>\n               </div>`:"",i=e.description?this.escapeHtml(e.description):"Sem descrição disponível";return`\n            <article class="project-card fade-in">\n                <h3 class="project-card__title">${this.escapeHtml(e.name)}</h3>\n                <p class="project-card__description">${i}</p>\n                \n                ${e.topics&&e.topics.length>0?`\n                    <div class="project-card__topics">\n                        ${t}\n                    </div>\n                `:""}\n                \n                <div class="project-card__meta">\n                    ${n}\n                    ${o}\n                </div>\n                \n                <a href="${this.escapeHtml(e.html_url)}" \n                   class="project-card__link" \n                   target="_blank" \n                   rel="noopener noreferrer"\n                   aria-label="Ver projeto ${this.escapeHtml(e.name)} no GitHub">\n                    Ver no GitHub\n                    <span aria-hidden="true">→</span>\n                </a>\n            </article>\n        `}renderProjectsError(e){e.innerHTML=`\n            <div class="projects__error">\n                <p>Erro ao carregar projetos. A mostrar projetos em destaque:</p>\n                ${this.getFallbackProjects()}\n            </div>\n        `}renderProjectsFallback(e){e.innerHTML=`\n            <div class="projects__fallback">\n                ${this.getFallbackProjects()}\n            </div>\n        `}getFallbackProjects(){return[{name:"curso-js-2026-pt",description:"Curso completo de JavaScript moderno em português",language:"JavaScript",topics:["javascript","tutorial","português","educação"],html_url:"https://github.com/smpsandro1239/curso-js-2026-pt"},{name:"portfolio-dev-senior",description:"Portfolio técnico desenvolvido em HTML, CSS e JavaScript vanilla",language:"JavaScript",topics:["portfolio","vanilla-js","css3","html5"],html_url:"https://github.com/smpsandro1239/portfolio-dev-senior"},{name:"freqtrade-strategies",description:"Estratégias avançadas de trading algorítmico",language:"Python",topics:["trading","algoritmos","fintech"],html_url:"https://github.com/smpsandro1239/freqtrade"}].map(e=>this.createProjectCard(e)).join("")}setupAnimations(){this.animationController&&(this.animationController.observeElements(".hero"),this.animationController.observeElements(".section__title"),this.animationController.observeElements(".stat-card"),this.animationController.observeElements(".stats-streak"),this.animationController.observeElements(".stats-activity"),this.animationController.observeElements(".course"),this.animationController.observeElements(".contact"))}setupHeaderScrollEffect(){const e=document.querySelector(".header");if(!e)return;let t=!1;const n=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled"),t=!1};window.addEventListener("scroll",()=>{t||(window.requestAnimationFrame(n),t=!0)},{passive:!0})}updateCopyrightYear(){const e=document.getElementById("current-year");e&&(e.textContent=(new Date).getFullYear())}logPerformanceMetrics(){if("performance"in window&&"getEntriesByType"in performance){const e=performance.getEntriesByType("navigation")[0];e&&console.log("Performance Metrics:",{"DOM Content Loaded":`${Math.round(e.domContentLoadedEventEnd-e.domContentLoadedEventStart)}ms`,"Load Complete":`${Math.round(e.loadEventEnd-e.loadEventStart)}ms`,"Total Load Time":`${Math.round(e.loadEventEnd-e.fetchStart)}ms`})}}handleUnhandledRejection(e){console.error("Unhandled promise rejection:",e.reason),e.preventDefault(),this.handleError(e.reason)}handleError(e){console.error("Application error:",e),("NetworkError"===e.name||e.message.includes("fetch"))&&console.warn("Network error detected - using fallback content")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}destroy(){document.removeEventListener("DOMContentLoaded",this.handleDOMContentLoaded),window.removeEventListener("load",this.handleWindowLoad),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.themeManager&&this.themeManager.destroy(),this.navigationManager&&this.navigationManager.destroy(),this.animationController&&this.animationController.destroy(),console.log("Portfolio app destroyed")}}const app=new PortfolioApp;app.init(),window.addEventListener("beforeunload",()=>{app.destroy()});export default PortfolioApp;